# ------------------------------------------------------------
# SERVER CONFIG
# ------------------------------------------------------------
server.port=8081
spring.main.web-application-type=servlet

# ------------------------------------------------------------
# KEYCLOAK CONFIG
# ------------------------------------------------------------
keycloak.realm=my-realm
keycloak.auth-server-url=http://localhost:8080

# Token & revoke endpoints used by KeycloakAuthService
keycloak.token-url=${keycloak.auth-server-url}/realms/${keycloak.realm}/protocol/openid-connect/token
keycloak.logout-url=${keycloak.auth-server-url}/realms/${keycloak.realm}/protocol/openid-connect/revoke

# Optional defaults for testing
keycloak.client-id=spring-app
keycloak.client-secret=vYbuDDmT4ouy6vBn6ZzaEPkmaMSHfvab

# ------------------------------------------------------------
# RESOURCE SERVER (JWT)
# ------------------------------------------------------------
spring.security.oauth2.resourceserver.jwt.issuer-uri=${keycloak.auth-server-url}/realms/${keycloak.realm}

# ------------------------------------------------------------
# RATE LIMITING (Bucket4j)
# ------------------------------------------------------------
bucket4j.enabled=true

# Limit /auth/login for client spring-app: 5 requests per minute
bucket4j.filters[0].cache-name=rate-limit-cache
bucket4j.filters[0].url=/api/auth/login
bucket4j.filters[0].rate-limits[0].expression=clientId == 'spring-app'
bucket4j.filters[0].rate-limits[0].bandwidths[0].capacity=5
bucket4j.filters[0].rate-limits[0].bandwidths[0].refill-capacity=5
bucket4j.filters[0].rate-limits[0].bandwidths[0].refill-period=1m

# Limit /api/admin: 20 requests per second
bucket4j.filters[1].cache-name=rate-limit-cache
bucket4j.filters[1].url=/api/api/admin
bucket4j.filters[1].rate-limits[0].bandwidths[0].capacity=20
bucket4j.filters[1].rate-limits[0].bandwidths[0].refill-capacity=20
bucket4j.filters[1].rate-limits[0].bandwidths[0].refill-period=1s